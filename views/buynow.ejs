<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout | Confirm Your Purchase</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #6366f1;
      --primary-hover: #4f46e5;
      --secondary-color: #f59e0b;
      --success-color: #10b981;
      --danger-color: #ef4444;
      --dark-color: #1e293b;
      --light-color: #f8fafc;
      --text-dark: #1e293b;
      --text-light: #64748b;
      --bg-light: #ffffff;
      --bg-dark: #0f172a;
      --card-bg-light: #ffffff;
      --card-bg-dark: #1e293b;
      --border-light: #e2e8f0;
      --border-dark: #334155;
      --shadow-color: rgba(0, 0, 0, 0.1);
      --gradient-start: #6366f1;
      --gradient-end: #f59e0b;
      --item-highlight: rgba(99, 102, 241, 0.1);
      --sidebar-width: 250px;
      --header-height: 70px;
    }

    [data-theme="dark"] {
      --primary-color: #818cf8;
      --primary-hover: #6366f1;
      --secondary-color: #fbbf24;
      --success-color: #34d399;
      --danger-color: #f87171;
      --dark-color: #f8fafc;
      --light-color: #1e293b;
      --text-dark: #f8fafc;
      --text-light: #94a3b8;
      --bg-light: #0f172a;
      --bg-dark: #1e293b;
      --card-bg-light: #1e293b;
      --card-bg-dark: #334155;
      --border-light: #334155;
      --border-dark: #475569;
      --shadow-color: rgba(0, 0, 0, 0.3);
      --gradient-start: #818cf8;
      --gradient-end: #fbbf24;
      --item-highlight: rgba(129, 140, 248, 0.15);
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: var(--bg-light);
      color: var(--text-dark);
      transition: all 0.4s ease;
      overflow-x: hidden;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding-top: var(--header-height);
    }

    /* Sidebar adjustments */
    .side {
      position: fixed;
      top: var(--header-height);
      left: 0;
      width: var(--sidebar-width);
      height: calc(100vh - var(--header-height));
      background: var(--bg-dark);
      color: var(--text-dark);
      z-index: 100;
      transition: all 0.3s ease;
      transform: translateX(-100%);
    }

    .side.active {
      transform: translateX(0);
    }

    /* Main content adjustments */
    .content-wrapper {
      flex: 1;
      padding-bottom: 60px;
      margin-left: 0;
      transition: margin-left 0.3s ease;
    }

    @media (min-width: 992px) {
      .side {
        transform: translateX(0);
      }
      .content-wrapper {
        margin-left: var(--sidebar-width);
      }
    }

    /* Floating particles background */
    .particles {
      position: fixed;
      top: var(--header-height);
      left: 0;
      width: 100%;
      height: calc(100vh - var(--header-height));
      z-index: -1;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      background: var(--primary-color);
      border-radius: 50%;
      opacity: 0.3;
      animation: floatParticle linear infinite;
    }

    @keyframes floatParticle {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 0.3;
      }
      100% {
        transform: translateY(-100vh) rotate(360deg);
        opacity: 0;
      }
    }

    /* Help floating action button */
    .help-fab {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 55px;
      height: 55px;
      background: var(--primary-color);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      box-shadow: 0 5px 20px rgba(99, 102, 241, 0.3);
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 100;
    }

    .help-fab:hover {
      transform: scale(1.1) rotate(15deg);
      box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
    }

    .help-tooltip {
      position: absolute;
      right: 65px;
      background: var(--card-bg-light);
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 5px 15px var(--shadow-color);
      width: 220px;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s ease;
      transform: translateX(15px);
      border: 1px solid var(--border-light);
    }

    .help-fab:hover .help-tooltip {
      opacity: 1;
      transform: translateX(0);
    }

    .help-tooltip h4 {
      margin-bottom: 8px;
      color: var(--primary-color);
      font-size: 0.95rem;
    }

    .help-tooltip p {
      font-size: 0.85rem;
      color: var(--text-light);
      line-height: 1.4;
    }

    .main-container {
      max-width: 1400px;
      margin: 40px auto;
      padding: 0 20px;
      position: relative;
      z-index: 1;
    }

    /* Animated header with floating elements */
    .checkout-header {
      text-align: center;
      margin-bottom: 40px;
      position: relative;
      overflow: hidden;
      padding: 40px 0;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
      color: white;
      box-shadow: 0 15px 30px rgba(99, 102, 241, 0.25);
      animation: gradientShift 10s ease infinite;
      background-size: 200% 200%;
      z-index: 2;
    }

    .checkout-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      opacity: 0.3;
      animation: patternMove 60s linear infinite;
    }

    @keyframes patternMove {
      0% { background-position: 0 0; }
      100% { background-position: 1000px 1000px; }
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .checkout-header h1 {
      font-weight: 700;
      font-size: 2.8rem;
      margin-bottom: 15px;
      animation: fadeInUp 0.8s ease both;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      position: relative;
    }

    .checkout-header p {
      font-size: 1.2rem;
      opacity: 0.9;
      animation: fadeInUp 0.8s ease 0.2s both;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      position: relative;
    }

    .checkout-header .header-icon {
      font-size: 3rem;
      margin-bottom: 20px;
      display: inline-block;
      animation: bounce 2s ease infinite, fadeIn 0.8s ease both;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Main checkout grid layout */
    .checkout-grid {
      display: grid;
      grid-template-columns: 1.5fr 1fr;
      gap: 30px;
      margin-top: 30px;
      perspective: 1000px;
    }

    @media (max-width: 992px) {
      .checkout-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Order summary section with enhanced item display */
    .order-summary {
      background-color: var(--card-bg-light);
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 8px 30px var(--shadow-color);
      border: 1px solid var(--border-light);
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      transform-style: preserve-3d;
      position: relative;
      overflow: hidden;
      height: fit-content;
    }

    .order-summary::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.03) 0%, rgba(245, 158, 11, 0.03) 100%);
      z-index: 0;
    }

    .order-summary:hover {
      transform: translateY(-10px) rotateY(2deg);
      box-shadow: 0 15px 40px var(--shadow-color);
    }

    .order-summary h2 {
      font-weight: 600;
      margin-bottom: 25px;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      z-index: 1;
      font-size: 1.8rem;
    }

    .order-summary h2 i {
      font-size: 1.5rem;
      transition: transform 0.3s ease;
    }

    .order-summary:hover h2 i {
      transform: rotate(-10deg);
    }

    .cart-items-container {
      position: relative;
      z-index: 1;
    }

    .cart-items {
      max-height: 500px;
      overflow-y: auto;
      padding-right: 10px;
      scrollbar-width: thin;
      scrollbar-color: var(--primary-color) var(--border-light);
    }

    .cart-items::-webkit-scrollbar {
      width: 6px;
    }

    .cart-items::-webkit-scrollbar-track {
      background: var(--border-light);
      border-radius: 10px;
    }

    .cart-items::-webkit-scrollbar-thumb {
      background-color: var(--primary-color);
      border-radius: 10px;
    }

    /* Enhanced cart item styling - more compact */
    .cart-item {
      display: grid;
      grid-template-columns: 80px 1fr;
      gap: 15px;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 15px;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      animation: slideIn 0.6s ease forwards;
      opacity: 0;
      background-color: var(--card-bg-light);
      box-shadow: 0 2px 8px var(--shadow-color);
      border: 1px solid var(--border-light);
      position: relative;
      overflow: hidden;
    }

    .cart-item::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(to bottom, var(--primary-color), var(--secondary-color));
      transition: all 0.3s ease;
    }

    .cart-item:hover::after {
      width: 6px;
      background: linear-gradient(to bottom, var(--secondary-color), var(--primary-color));
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .cart-item:hover {
      transform: translateX(5px) scale(1.01);
      box-shadow: 0 5px 15px var(--shadow-color);
      background-color: var(--item-highlight);
      z-index: 2;
    }

    .product-image-container {
      position: relative;
      width: 80px;
      height: 80px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      align-self: center;
    }

    .product-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: all 0.5s ease;
    }

    .cart-item:hover .product-image {
      transform: scale(1.05);
    }

    .product-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--secondary-color);
      color: white;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      z-index: 2;
      animation: pulseBadge 2s infinite;
    }

    @keyframes pulseBadge {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    .product-info {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .product-title {
      font-weight: 600;
      margin-bottom: 5px;
      color: var(--text-dark);
      font-size: 1rem;
      transition: all 0.3s ease;
      line-height: 1.3;
    }

    .cart-item:hover .product-title {
      color: var(--primary-color);
    }

    .product-price {
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 5px;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .product-price span {
      color: var(--text-light);
      font-weight: 500;
      font-size: 0.85rem;
      text-decoration: line-through;
      opacity: 0.7;
    }

    .product-meta {
      display: flex;
      gap: 12px;
      margin-top: 3px;
      flex-wrap: wrap;
    }

    .product-quantity, .product-color {
      display: flex;
      align-items: center;
      gap: 5px;
      color: var(--text-light);
      font-size: 0.85rem;
    }

    .product-color-swatch {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: 1px solid var(--border-light);
    }

    .product-actions {
      display: flex;
      gap: 10px;
      margin-top: 8px;
    }

    .action-btn {
      background: none;
      border: none;
      color: var(--text-light);
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 3px 8px;
      border-radius: 5px;
      background-color: rgba(0,0,0,0.03);
    }

    .action-btn:hover {
      color: var(--primary-color);
      background-color: rgba(99, 102, 241, 0.1);
    }

    .action-btn i {
      font-size: 0.8rem;
    }

    /* Order totals section */
    .order-total {
      margin-top: 25px;
      padding-top: 20px;
      border-top: 2px dashed var(--border-light);
      position: relative;
    }

    .order-total::before {
      content: '';
      position: absolute;
      top: -2px;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
      opacity: 0.3;
    }

    .total-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding: 5px 0;
      border-bottom: 1px dotted var(--border-light);
      transition: all 0.3s ease;
    }

    .total-row:hover {
      transform: translateX(3px);
      border-bottom-color: var(--primary-color);
    }

    .total-label {
      color: var(--text-light);
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95rem;
    }

    .total-label i {
      font-size: 0.85rem;
      opacity: 0.7;
    }

    .total-value {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .grand-total {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-top: 15px;
      padding-top: 10px;
      border-top: 2px solid var(--border-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .grand-total .total-label {
      font-size: 1.1rem;
      color: var(--text-dark);
    }

    .grand-total .total-value {
      font-size: 1.3rem;
      color: var(--primary-color);
    }

    /* Discount coupon section */
    .coupon-section {
      margin-top: 20px;
      background: rgba(99, 102, 241, 0.05);
      border-radius: 10px;
      padding: 15px;
      border: 1px dashed var(--primary-color);
      animation: pulseBorder 3s infinite;
    }

    @keyframes pulseBorder {
      0% { border-color: var(--primary-color); }
      50% { border-color: var(--secondary-color); }
      100% { border-color: var(--primary-color); }
    }

    .coupon-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      color: var(--primary-color);
      font-size: 0.95rem;
    }

    .coupon-header i {
      font-size: 1.1rem;
    }

    .coupon-form {
      display: flex;
      gap: 8px;
    }

    .coupon-input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid var(--border-light);
      border-radius: 8px;
      background-color: var(--bg-light);
      color: var(--text-dark);
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .coupon-input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
      outline: none;
    }

    .coupon-btn {
      padding: 8px 15px;
      background-color: var(--secondary-color);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .coupon-btn:hover {
      background-color: var(--primary-color);
      transform: translateY(-2px);
    }

    /* Checkout form section */
    .checkout-form {
      background-color: var(--card-bg-light);
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 8px 30px var(--shadow-color);
      border: 1px solid var(--border-light);
      transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      transform-style: preserve-3d;
      position: relative;
      overflow: hidden;
      height: fit-content;
    }

    .checkout-form::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.03) 0%, rgba(245, 158, 11, 0.03) 100%);
      z-index: 0;
    }

    .checkout-form:hover {
      transform: translateY(-10px) rotateY(-2deg);
      box-shadow: 0 15px 40px var(--shadow-color);
    }

    .checkout-form h2 {
      font-weight: 600;
      margin-bottom: 25px;
      color: var(--primary-color);
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      z-index: 1;
      font-size: 1.8rem;
    }

    .checkout-form h2 i {
      font-size: 1.5rem;
      transition: transform 0.3s ease;
    }

    .checkout-form:hover h2 i {
      transform: rotate(10deg);
    }

    /* Form group styling */
    .form-group {
      margin-bottom: 20px;
      position: relative;
      z-index: 1;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-dark);
      position: relative;
      padding-left: 15px;
      font-size: 0.95rem;
    }

    .form-label::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 8px;
      height: 8px;
      background: var(--primary-color);
      border-radius: 50%;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .form-group:focus-within .form-label::before {
      opacity: 1;
    }

    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid var(--border-light);
      border-radius: 10px;
      background-color: var(--bg-light);
      color: var(--text-dark);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      font-size: 0.95rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .form-control:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
      outline: none;
      transform: translateY(-2px);
    }

    .form-control:hover {
      border-color: var(--primary-color);
    }

    /* Floating label effect */
    .floating-label-group {
      position: relative;
      margin-top: 15px;
    }

    .floating-label {
      position: absolute;
      top: 14px;
      left: 18px;
      color: var(--text-light);
      transition: all 0.3s ease;
      pointer-events: none;
      background: var(--card-bg-light);
      padding: 0 5px;
    }

    .form-control:focus + .floating-label,
    .form-control:not(:placeholder-shown) + .floating-label {
      top: -10px;
      left: 15px;
      font-size: 0.8rem;
      color: var(--primary-color);
      background: var(--card-bg-light);
      z-index: 1;
    }

    /* Error message styling */
    .error-message {
      color: var(--danger-color);
      font-size: 0.85rem;
      margin-top: 8px;
      display: none;
      animation: shake 0.4s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
      transform: translate3d(0, 0, 0);
      backface-visibility: hidden;
      perspective: 1000px;
      position: absolute;
      padding-left: 15px;
    }

    @keyframes shake {
      10%, 90% { transform: translate3d(-1px, 0, 0); }
      20%, 80% { transform: translate3d(2px, 0, 0); }
      30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
      40%, 60% { transform: translate3d(4px, 0, 0); }
    }

    /* Payment options section */
    .payment-options {
      margin: 25px 0;
    }

    .payment-options h3 {
      font-weight: 500;
      margin-bottom: 15px;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.1rem;
    }

    .payment-options h3 i {
      color: var(--primary-color);
    }

    .payment-option {
      display: flex;
      align-items: center;
      padding: 15px;
      border: 1px solid var(--border-light);
      border-radius: 10px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      background-color: var(--card-bg-light);
      position: relative;
      overflow: hidden;
    }

    .payment-option::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--primary-color);
      transition: all 0.3s ease;
      transform: translateX(-100%);
    }

    .payment-option:hover {
      border-color: var(--primary-color);
      background-color: var(--item-highlight);
      transform: translateX(5px);
    }

    .payment-option:hover::before {
      transform: translateX(0);
    }

    .payment-option.active {
      border-color: var(--primary-color);
      background-color: var(--item-highlight);
      box-shadow: 0 5px 15px rgba(99, 102, 241, 0.1);
    }

    .payment-option.active::before {
      transform: translateX(0);
    }

    .payment-icon {
      margin-right: 15px;
      font-size: 1.5rem;
      color: var(--primary-color);
      transition: all 0.3s ease;
    }

    .payment-option:hover .payment-icon {
      transform: scale(1.1) rotate(5deg);
    }

    .payment-details {
      flex: 1;
    }

    .payment-title {
      font-weight: 600;
      margin-bottom: 3px;
      color: var(--text-dark);
      font-size: 0.95rem;
    }

    .payment-description {
      color: var(--text-light);
      font-size: 0.85rem;
      line-height: 1.4;
    }

    .payment-badge {
      display: inline-block;
      margin-top: 5px;
      padding: 2px 6px;
      background: var(--secondary-color);
      color: white;
      border-radius: 4px;
      font-size: 0.65rem;
      font-weight: 600;
    }

    /* Button group styling */
    .btn-group {
      display: flex;
      gap: 15px;
      margin-top: 30px;
      position: relative;
      z-index: 1;
    }

    .btn {
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 0.95rem;
      border: none;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent);
      transform: translateX(-100%);
      transition: all 0.6s ease;
    }

    .btn:hover::before {
      transform: translateX(100%);
    }

    .btn-primary {
      background-color: var(--primary-color);
      color: white;
      flex: 1;
      box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
    }

    .btn-primary:hover {
      background-color: var(--primary-hover);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(99, 102, 241, 0.4);
    }

    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--border-light);
      color: var(--text-dark);
    }

    .btn-outline:hover {
      background-color: rgba(99, 102, 241, 0.05);
      border-color: var(--primary-color);
      color: var(--primary-color);
      transform: translateY(-3px);
    }

    /* Empty cart state */
    .empty-cart {
      text-align: center;
      padding: 40px 0;
      animation: fadeIn 0.8s ease;
    }

    .empty-cart i {
      font-size: 3.5rem;
      color: var(--text-light);
      margin-bottom: 20px;
      opacity: 0.5;
      animation: bounce 2s ease infinite;
    }

    .empty-cart h4 {
      margin-bottom: 12px;
      color: var(--text-dark);
      font-size: 1.3rem;
    }

    .empty-cart p {
      color: var(--text-light);
      margin-bottom: 25px;
      font-size: 1rem;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }

    /* Ribbon for special offers */
    .ribbon {
      width: 120px;
      height: 120px;
      overflow: hidden;
      position: absolute;
      top: -10px;
      right: -10px;
      z-index: 1;
    }

    .ribbon-content {
      position: absolute;
      display: block;
      width: 180px;
      padding: 12px 0;
      background-color: var(--secondary-color);
      box-shadow: 0 5px 10px rgba(0,0,0,.1);
      color: #fff;
      font-size: 0.8rem;
      text-align: center;
      right: -20px;
      top: 25px;
      transform: rotate(45deg);
      font-weight: 600;
    }

    .ribbon-content::before,
    .ribbon-content::after {
      content: '';
      position: absolute;
      display: block;
      border: 4px solid var(--secondary-color);
      z-index: -1;
    }

    .ribbon-content::before {
      left: 0;
      bottom: -5px;
      border-right-color: transparent;
      border-bottom-color: transparent;
    }

    .ribbon-content::after {
      right: 0;
      bottom: -5px;
      border-left-color: transparent;
      border-bottom-color: transparent;
    }

    /* Progress steps */
    .progress-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 30px;
      position: relative;
    }

    .progress-steps::before {
      content: '';
      position: absolute;
      top: 12px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--border-light);
      z-index: 0;
    }

    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      z-index: 1;
    }

    .step-icon {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--border-light);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 6px;
      color: var(--text-light);
      transition: all 0.3s ease;
      font-size: 0.9rem;
    }

    .step.active .step-icon {
      background: var(--primary-color);
      color: white;
      transform: scale(1.1);
    }

    .step.completed .step-icon {
      background: var(--success-color);
      color: white;
    }

    .step-label {
      font-size: 0.8rem;
      color: var(--text-light);
      font-weight: 500;
    }

    .step.active .step-label {
      color: var(--primary-color);
      font-weight: 600;
    }

    .step.completed .step-label {
      color: var(--success-color);
    }

    /* Security badge */
    .security-badge {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 25px;
      padding-top: 15px;
      border-top: 1px solid var(--border-light);
      color: var(--text-light);
      font-size: 0.85rem;
    }

    .security-badge i {
      color: var(--success-color);
      font-size: 1.1rem;
    }

    /* Loading spinner */
    .spinner {
      display: none;
      width: 18px;
      height: 18px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Success animation */
    @keyframes checkmark {
      0% { stroke-dashoffset: 50; }
      100% { stroke-dashoffset: 0; }
    }

    .checkmark {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: block;
      stroke-width: 3;
      stroke: #fff;
      stroke-miterlimit: 10;
      margin: 0 auto;
      stroke-dasharray: 50;
      stroke-dashoffset: 50;
      animation: checkmark 0.6s ease-in-out forwards;
    }

    /* Confetti animation */
    .confetti {
      position: fixed;
      width: 8px;
      height: 8px;
      background-color: var(--primary-color);
      opacity: 0;
      z-index: 1000;
      animation: confetti 5s ease-in-out;
    }

    @keyframes confetti {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(1000px) rotate(720deg);
        opacity: 0;
      }
    }

    /* 3D card effect on hover */
    .card-3d {
      transform-style: preserve-3d;
      transition: all 0.5s ease;
    }

    .card-3d:hover {
      transform: rotateY(5deg) rotateX(2deg);
    }

    /* Floating animation for elements */
    .float {
      animation: floating 3s ease-in-out infinite;
    }

    @keyframes floating {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
      100% { transform: translateY(0px); }
    }

    /* Glow effect */
    .glow {
      animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from {
        box-shadow: 0 0 5px rgba(99, 102, 241, 0.5);
      }
      to {
        box-shadow: 0 0 15px rgba(99, 102, 241, 0.8);
      }
    }

    /* Pulse animation for buttons */
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); }
      100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
    }

    .btn-pulse {
      animation: pulse 2s infinite;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .checkout-header h1 {
        font-size: 2.2rem;
      }
      
      .checkout-header p {
        font-size: 1rem;
      }
      
      .btn-group {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
      
      .cart-item {
        grid-template-columns: 70px 1fr;
        gap: 12px;
        padding: 12px;
      }
      
      .product-image-container {
        width: 70px;
        height: 70px;
      }
      
      .help-fab {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
        bottom: 20px;
        right: 20px;
      }
    }

    @media (max-width: 576px) {
      .checkout-header {
        padding: 30px 15px;
      }
      
      .checkout-header h1 {
        font-size: 1.8rem;
      }
      
      .order-summary, .checkout-form {
        padding: 20px;
      }
      
      .main-container {
        margin: 20px auto;
      }
      
      .progress-steps {
        margin-bottom: 20px;
      }
      
      .step-label {
        font-size: 0.7rem;
      }
    }

    /* Animation delays for cart items */
    .cart-item:nth-child(1) { animation-delay: 0.1s; }
    .cart-item:nth-child(2) { animation-delay: 0.2s; }
    .cart-item:nth-child(3) { animation-delay: 0.3s; }
    .cart-item:nth-child(4) { animation-delay: 0.4s; }
    .cart-item:nth-child(5) { animation-delay: 0.5s; }
    .cart-item:nth-child(6) { animation-delay: 0.6s; }
    .cart-item:nth-child(7) { animation-delay: 0.7s; }
    .cart-item:nth-child(8) { animation-delay: 0.8s; }

    /* Footer styling */
    footer {
      background-color: var(--bg-dark);
      color: var(--text-dark);
      padding: 20px 0;
      text-align: center;
      margin-top: auto;
    }
  </style>
</head>
<body>
  
  <%- include("../utils/header")%> 
  <%- include("side")%>
    
  <!-- Content wrapper to push footer down -->
  <div class="content-wrapper">
    <!-- Floating particles background -->
    <div class="particles" id="particles"></div>

    <!-- Help floating action button -->
    <div class="help-fab">
      <i class="fas fa-question"></i>
      <div class="help-tooltip">
        <h4>Need Help?</h4>
        <p>Our customer support team is available 24/7 to assist you with your order.</p>
      </div>
    </div>

    <div class="main-container">
      <!-- Animated Header -->
      <header class="checkout-header card-3d">
        <div class="container">
          <i class="fas fa-shopping-cart header-icon float"></i>
          <h1>Complete Your Purchase</h1>
          <p>Review your items and enter your details to proceed</p>
        </div>
      </header>

      <!-- Progress steps -->
      <div class="progress-steps">
        <div class="step completed">
          <div class="step-icon"><i class="fas fa-shopping-cart"></i></div>
          <div class="step-label">Cart</div>
        </div>
        <div class="step active">
          <div class="step-icon"><i class="fas fa-user-edit"></i></div>
          <div class="step-label">Details</div>
        </div>
        <div class="step">
          <div class="step-icon"><i class="fas fa-truck"></i></div>
          <div class="step-label">Shipping</div>
        </div>
        <div class="step">
          <div class="step-icon"><i class="fas fa-check"></i></div>
          <div class="step-label">Complete</div>
        </div>
      </div>

      <!-- Main Checkout Grid -->
      <div class="checkout-grid">
        <!-- Order Summary Section -->
        <section class="order-summary card-3d">
          <div class="ribbon">
            <div class="ribbon-content">Special Offer!</div>
          </div>
          
          <h2><i class="fas fa-shopping-bag"></i> Order Summary</h2>
          
          <div class="cart-items-container">
            <div class="cart-items" id="cartItems">
              <% if(cart && cart.length > 0) { %>
                <% let subtotal = 0; %>
                <% cart.forEach((item, index) => { %>
                  <div class="cart-item" style="animation-delay: <%= index * 0.1 %>s">
                    <div class="product-image-container">
                      <img src="<%= item.product_image || 'https://via.placeholder.com/400x400?text=Product' %>" 
                           alt="<%= item.product_name %>" 
                           class="product-image">
                      <div class="product-badge"><%= item.product_quantity %></div>
                    </div>
                    <div class="product-info">
                      <h4 class="product-title"><%= item.product_name %></h4>
                      <p class="product-price">
                        ₹<%= (item.product_price * item.product_quantity).toFixed(2) %>
                        <% if(item.product_discount) { %>
                          <span>₹<%= (item.product_price * item.product_quantity * (1 + item.product_discount/100)).toFixed(2) %></span>
                        <% } %>
                      </p>
                      <div class="product-meta">
                        <span class="product-quantity">
                          <i class="fas fa-layer-group"></i> Qty: <%= item.product_quantity %>
                        </span>
                        <% if(item.product_color) { %>
                          <span class="product-color">
                            <i class="fas fa-palette"></i> 
                            <span class="product-color-swatch" style="background-color: <%= item.product_color %>"></span>
                            <%= item.product_color_name || 'Color' %>
                          </span>
                        <% } %>
                      </div>
                      <div class="product-actions">
                        <button class="action-btn">
                          <i class="fas fa-heart"></i> Save
                        </button>
                        <button class="action-btn">
                          <i class="fas fa-trash-alt"></i> Remove
                        </button>
                      </div>
                    </div>
                  </div>
                  <% subtotal += item.product_price * item.product_quantity; %>
                <% }); %>
                
                <!-- Coupon section -->
                <div class="coupon-section">
                  <div class="coupon-header">
                    <i class="fas fa-tag"></i>
                    <h4>Apply Coupon Code</h4>
                  </div>
                  <form class="coupon-form">
                    <input type="text" class="coupon-input" placeholder="Enter coupon code">
                    <button type="button" class="coupon-btn">Apply</button>
                  </form>
                </div>
                
                <div class="order-total">
                  <div class="total-row">
                    <span class="total-label"><i class="fas fa-shopping-basket"></i> Subtotal:</span>
                    <span class="total-value">₹<%= subtotal.toFixed(2) %></span>
                  </div>
                  <div class="total-row">
                    <span class="total-label"><i class="fas fa-truck"></i> Shipping:</span>
                    <span class="total-value">Free</span>
                  </div>
                  <div class="total-row">
                    <span class="total-label"><i class="fas fa-receipt"></i> Tax (18%):</span>
                    <span class="total-value">₹<%= (subtotal * 0.18).toFixed(2) %></span>
                  </div>
                  <div class="total-row">
                    <span class="total-label"><i class="fas fa-percentage"></i> Discount:</span>
                    <span class="total-value">-₹0.00</span>
                  </div>
                  <div class="grand-total">
                    <span class="total-label"><i class="fas fa-receipt"></i> Total Amount:</span>
                    <span class="total-value">₹<span id="totalAmount"><%= (subtotal * 1.18).toFixed(2) %></span></span>
                  </div>
                </div>
              <% } else { %>
                <div class="empty-cart">
                  <i class="fas fa-shopping-cart"></i>
                  <h4>Your cart is empty</h4>
                  <p>Looks like you haven't added any items to your cart yet. Start shopping to fill it up!</p>
                  <a href="/products" class="btn btn-outline">
                    <i class="fas fa-arrow-left"></i> Continue Shopping
                  </a>
                </div>
              <% } %>
            </div>
          </div>
        </section>

        <!-- Checkout Form Section -->
        <section class="checkout-form card-3d">
          <h2><i class="fas fa-user-edit"></i> Customer Details</h2>
          
          <form id="checkoutForm" action="/confirm_purchase1" method="POST">
            <div class="form-group">
              <label for="name" class="form-label">Full Name</label>
              <input type="text" id="name" name="name" class="form-control" placeholder="Enter your full name" required>
              <div id="nameError" class="error-message">Please enter your name</div>
            </div>
            
            <div class="form-group">
              <label for="email" class="form-label">Email Address</label>
              <input type="email" id="email" name="email" class="form-control" placeholder="Enter your email" required>
              <div id="emailError" class="error-message">Please enter a valid email address</div>
            </div>
            
            <div class="form-group">
              <label for="phone" class="form-label">Phone Number</label>
              <input type="tel" id="phone" name="phone" class="form-control" placeholder="Enter your phone number" required>
              <div id="phoneError" class="error-message">Please enter a valid 10-digit phone number</div>
            </div>
            
            <div class="form-group">
              <label for="address" class="form-label">Shipping Address</label>
              <textarea id="address" name="address" class="form-control" rows="4" placeholder="Enter your complete shipping address with landmark" required></textarea>
              <div id="addressError" class="error-message">Please enter your shipping address</div>
            </div>
            
            <div class="form-group">
              <label for="notes" class="form-label">Order Notes (Optional)</label>
              <textarea id="notes" name="notes" class="form-control" rows="2" placeholder="Any special instructions for your order"></textarea>
            </div>
            
            <div class="payment-options">
              <h3 class="form-label"><i class="fas fa-credit-card"></i> Payment Method</h3>
              
              <div class="payment-option active" id="codOption">
                <div class="payment-icon">
                  <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="payment-details">
                  <div class="payment-title">Cash on Delivery</div>
                  <div class="payment-description">Pay when you receive your order</div>
                  <div class="payment-badge">No extra charges</div>
                </div>
              </div>
              
              <div class="payment-option" id="onlineOption">
                <div class="payment-icon">
                  <i class="fas fa-credit-card"></i>
                </div>
                <div class="payment-details">
                  <div class="payment-title">Online Payment</div>
                  <div class="payment-description">Pay securely with Razorpay</div>
                  <div class="payment-badge">Fast & Secure</div>
                </div>
              </div>
            </div>
            
            <input type="hidden" id="paymentMethod" name="paymentMethod" value="cod">
            <input type="hidden" id="hiddenTotalAmount" name="totalAmount" value="">
            
            <div class="btn-group">
              <button type="submit" class="btn btn-primary btn-pulse" id="submitBtn">
                <span id="submitText">Complete Order</span>
                <div class="spinner" id="submitSpinner"></div>
                <svg id="submitSuccess" class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52" style="display: none;">
                  <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                  <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                </svg>
              </button>
              <a href="/cart" class="btn btn-outline">
                <i class="fas fa-arrow-left"></i> Back to Cart
              </a>
            </div>
            
            <div class="security-badge">
              <i class="fas fa-lock"></i>
              <span>Secure checkout. Your information is protected.</span>
            </div>
          </form>
        </section>
      </div>
    </div>
  </div>
  <%- include("../utils/footer"); %>  

  <!-- Include Bootstrap JS and dependencies -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Razorpay checkout script -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  
  <script>
    $(document).ready(function() {
      // Create floating particles
      function createParticles() {
        const particlesContainer = $('#particles');
        const particleCount = 30;
        
        for (let i = 0; i < particleCount; i++) {
          const particle = $('<div class="particle"></div>');
          const size = Math.random() * 10 + 5;
          const posX = Math.random() * 100;
          const delay = Math.random() * 10;
          const duration = Math.random() * 20 + 10;
          
          particle.css({
            width: `${size}px`,
            height: `${size}px`,
            left: `${posX}%`,
            top: '100%',
            opacity: Math.random() * 0.5 + 0.1,
            animationDelay: `${delay}s`,
            animationDuration: `${duration}s`
          });
          
          // Random color based on theme
          const colors = [
            'var(--primary-color)',
            'var(--secondary-color)',
            'var(--success-color)'
          ];
          const randomColor = colors[Math.floor(Math.random() * colors.length)];
          particle.css('background', randomColor);
          
          particlesContainer.append(particle);
        }
      }
      
      createParticles();
      
      // Check for dark theme preference from localStorage or system preference
      function checkThemePreference() {
        const savedTheme = localStorage.getItem('theme');
        const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
          $('body').attr('data-theme', 'dark');
        } else {
          $('body').attr('data-theme', 'light');
        }
        
        // Recreate particles with new theme colors
        $('#particles').empty();
        createParticles();
      }
      
      // Initialize theme
      checkThemePreference();
      
      // Set the total amount value in the hidden input field
      const totalAmount = $('#totalAmount').text().trim();
      $('#hiddenTotalAmount').val(totalAmount);
      
      // Payment method selection
      $('.payment-option').on('click', function() {
        $('.payment-option').removeClass('active');
        $(this).addClass('active');
        
        if ($(this).attr('id') === 'onlineOption') {
          $('#paymentMethod').val('online');
          $('#submitText').text('Pay Now');
          $('#submitBtn').addClass('glow');
        } else {
          $('#paymentMethod').val('cod');
          $('#submitText').text('Complete Order');
          $('#submitBtn').removeClass('glow');
        }
      });
      
      // Form validation function
      function validateForm() {
        let isValid = true;
        
        // Validate name
        if ($('#name').val().trim() === '') {
          $('#nameError').show();
          isValid = false;
          $('#name').addClass('error');
        } else {
          $('#nameError').hide();
          $('#name').removeClass('error');
        }
        
        // Validate email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test($('#email').val())) {
          $('#emailError').show();
          isValid = false;
          $('#email').addClass('error');
        } else {
          $('#emailError').hide();
          $('#email').removeClass('error');
        }
        
        // Validate phone
        const phoneRegex = /^[0-9]{10}$/;
        if (!phoneRegex.test($('#phone').val())) {
          $('#phoneError').show();
          isValid = false;
          $('#phone').addClass('error');
        } else {
          $('#phoneError').hide();
          $('#phone').removeClass('error');
        }
        
        // Validate address
        if ($('#address').val().trim() === '') {
          $('#addressError').show();
          isValid = false;
          $('#address').addClass('error');
        } else {
          $('#addressError').hide();
          $('#address').removeClass('error');
        }
        
        return isValid;
      }
      
      // Handle form submission
      $('#checkoutForm').on('submit', function(e) {
        e.preventDefault();
        
        // Validate form before proceeding
        if (!validateForm()) {
          // Shake form on error
          $('.checkout-form').css('animation', 'shake 0.5s');
          setTimeout(() => {
            $('.checkout-form').css('animation', '');
          }, 500);
          return false;
        }
        
        // Check if cart is empty
        if (parseFloat(totalAmount) <= 0) {
          // Show error animation
          $('.order-summary').css('animation', 'shake 0.5s');
          setTimeout(() => {
            $('.order-summary').css('animation', '');
          }, 500);
          
          // Create floating notification
          const notification = $('<div class="alert alert-danger" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 2000; animation: fadeInDown 0.5s;">Your cart is empty. Please add products before checkout.</div>');
          $('body').append(notification);
          setTimeout(() => {
            notification.remove();
          }, 3000);
          
          return false;
        }
        
        const paymentMethod = $('#paymentMethod').val();
        const form = this;
        
        // Show loading spinner
        $('#submitText').hide();
        $('#submitSpinner').show();
        $('#submitBtn').prop('disabled', true);
        
        if (paymentMethod === 'online') {
          // Process online payment
          processOnlinePayment(form);
        } else {
          // Process COD - submit form directly
          setTimeout(() => {
            showSuccessAnimation();
            createConfetti();
            
            // Submit after animation
            setTimeout(() => {
              form.submit();
            }, 1500);
          }, 1000);
        }
      });
      
      // Process online payment with Razorpay
      function processOnlinePayment(form) {
        const amount = parseFloat(totalAmount) * 100; // Razorpay expects amount in paise
        
        const options = {
          "key": "rzp_test_wtrBaXbtEKahAZ", // Replace with your Razorpay key
          "amount": amount,
          "currency": "INR",
          "name": "Chain Core",
          "description": "Order Payment",
          "image": "<%=user_image%>",
          "prefill": {
            "name": $('#name').val(),
            "email": $('#email').val(),
            "contact": $('#phone').val()
          },
          "notes": {
            "address": $('#address').val(),
            "notes": $('#notes').val()
          },
          "theme": {
            "color": "#6366f1"
          },
          "handler": function(response) {
            // On successful payment
            showSuccessAnimation();
            createConfetti();
            
            // Create hidden inputs with payment details
            $('<input>').attr({
              type: 'hidden',
              name: 'razorpay_payment_id',
              value: response.razorpay_payment_id
            }).appendTo(form);
            
            $('<input>').attr({
              type: 'hidden',
              name: 'razorpay_order_id',
              value: response.razorpay_order_id || ''
            }).appendTo(form);
            
            $('<input>').attr({
              type: 'hidden',
              name: 'razorpay_signature',
              value: response.razorpay_signature || ''
            }).appendTo(form);
            
            // Submit the form after animation
            setTimeout(() => {
              form.submit();
            }, 1500);
          },
          "modal": {
            "ondismiss": function() {
              resetSubmitButton();
            }
          }
        };
        
        const rzp1 = new Razorpay(options);
        rzp1.open();
      }
      
      // Show success animation
      function showSuccessAnimation() {
        $('#submitSpinner').hide();
        $('#submitSuccess').show();
        $('#submitBtn').css('background-color', '#10b981');
      }
      
      // Create confetti effect
      function createConfetti() {
        const colors = ['#6366f1', '#f59e0b', '#10b981', '#ef4444', '#ffffff'];
        
        for (let i = 0; i < 100; i++) {
          const confetti = $('<div class="confetti"></div>');
          const size = Math.random() * 10 + 5;
          const color = colors[Math.floor(Math.random() * colors.length)];
          const left = Math.random() * 100;
          const delay = Math.random() * 5;
          const duration = Math.random() * 3 + 2;
          
          confetti.css({
            width: `${size}px`,
            height: `${size}px`,
            left: `${left}%`,
            background: color,
            animationDelay: `${delay}s`,
            animationDuration: `${duration}s`
          });
          
          $('body').append(confetti);
          
          // Remove confetti after animation
          setTimeout(() => {
            confetti.remove();
          }, duration * 1000);
        }
      }
      
      // Reset submit button state
      function resetSubmitButton() {
        $('#submitText').show();
        $('#submitSpinner').hide();
        $('#submitSuccess').hide();
        $('#submitBtn').prop('disabled', false);
        $('#submitBtn').css('background-color', '');
      }
      
      // Input validation on blur
      $('#name').on('blur', function() {
        if ($(this).val().trim() === '') {
          $('#nameError').show();
          $(this).addClass('error');
        } else {
          $('#nameError').hide();
          $(this).removeClass('error');
        }
      });
      
      $('#email').on('blur', function() {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test($(this).val())) {
          $('#emailError').show();
          $(this).addClass('error');
        } else {
          $('#emailError').hide();
          $(this).removeClass('error');
        }
      });
      
      $('#phone').on('blur', function() {
        const phoneRegex = /^[0-9]{10}$/;
        if (!phoneRegex.test($(this).val())) {
          $('#phoneError').show();
          $(this).addClass('error');
        } else {
          $('#phoneError').hide();
          $(this).removeClass('error');
        }
      });
      
      $('#address').on('blur', function() {
        if ($(this).val().trim() === '') {
          $('#addressError').show();
          $(this).addClass('error');
        } else {
          $('#addressError').hide();
          $(this).removeClass('error');
        }
      });
      
      // Add hover effect to cart items
      $('.cart-item').hover(
        function() {
          $(this).css('transform', 'translateX(5px) scale(1.01)');
        },
        function() {
          $(this).css('transform', '');
        }
      );
      
      // Animate elements on scroll
      function animateOnScroll() {
        $('.card-3d').each(function() {
          const cardPosition = $(this).offset().top;
          const scrollPosition = $(window).scrollTop() + $(window).height() * 0.8;
          
          if (scrollPosition > cardPosition) {
            $(this).css({
              opacity: 1,
              transform: 'translateY(0)'
            });
          }
        });
      }
      
      // Initial animation
      $('.card-3d').css({
        opacity: 0,
        transform: 'translateY(30px)',
        transition: 'all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275)'
      });
      
      // Run on load and scroll
      $(window).on('load scroll', animateOnScroll);
      
      // Initialize animations
      animateOnScroll();
      
      // Coupon code application
      $('.coupon-btn').on('click', function() {
        const couponInput = $('.coupon-input');
        if (couponInput.val().trim() === '') {
          couponInput.addClass('error');
          couponInput.attr('placeholder', 'Please enter a coupon code');
          return;
        }
        
        // Simulate coupon processing
        $(this).text('Applying...').prop('disabled', true);
        
        setTimeout(() => {
          // Simulate success
          $('.coupon-section').css('background', 'rgba(16, 185, 129, 0.1)');
          $('.coupon-header i').removeClass('fa-tag').addClass('fa-check-circle');
          $('.coupon-header h4').text('Coupon Applied!');
          $('.coupon-btn').text('Applied').css('background', '#10b981');
          
          // Update total with discount
          const discount = 100; // Example discount
          const currentTotal = parseFloat($('#totalAmount').text());
          const newTotal = currentTotal - discount;
          
          $('#totalAmount').text(newTotal.toFixed(2));
          $('#hiddenTotalAmount').val(newTotal.toFixed(2));
          
          // Add discount row
          $('.order-total .total-row:last').before(`
            <div class="total-row discount-row">
              <span class="total-label"><i class="fas fa-tag"></i> Discount:</span>
              <span class="total-value" style="color: var(--success-color);">-₹${discount.toFixed(2)}</span>
            </div>
          `);
          
          // Animate the change
          $('.discount-row').hide().slideDown();
          $('.grand-total').hide().slideDown();
        }, 1500);
      });

      // Theme toggle functionality
      function toggleTheme() {
        const currentTheme = $('body').attr('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        $('body').attr('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        
        // Recreate particles with new theme colors
        $('#particles').empty();
        createParticles();
      }

      // Handle theme toggle button click
      $(document).on('click', '.theme-toggle', function() {
        toggleTheme();
      });
    });
  </script>
</body>
</html>